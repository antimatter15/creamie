<script src="http.js"></script>
<script src="sha1.js"></script>
<script src="url.js"></script>
<script src="path.js"></script>
<script src="querystring.js"></script>
<script src="oauth.js"></script>

<script src="twitter-oauth.js"></script>
<script src="twitter-stream-client.js"></script>

<script src="twitter-rest-proxy.js"></script>

<script>
var Token = {};
var TransferURL = {};

//Todo: create an obscure, and ultimately futile system of
//obfuscating something that can't be obfuscated.


var key = '2fyLB1arhJ5ZtLRBEb9PA';
var secret = 'MgPrPI5fcfIxeUMqrCb1MrRa3468xImnfFGcKAIv1O0';


var host = 'antimatter15.com';
var token = null;

function getTwitterApiClient(cb) {
  oauth.reuse(key, secret, token, function (err, requester) {
    if(err) {
      respondError("no_auth")
    } else {
      cb(err, requester);
    }
  });
}

var oauth_callback_url = "http://example.com"; //probably bad callback URL, but hey, it works.


twitter_oauth.request(key, secret, oauth_callback_url, 
function (error, token, aurl, cont) {
	if(error) throw "EPIC FAIL OAUTH ONE";
	
    var temp = sha1.HMACSHA1(token,""+Math.random());

     console.log("oauth step 1 success");
     Token[token] = cont;
	 chrome.tabs.create({
		url: aurl
	}, function(tab){
		var poll = function(){
			chrome.tabs.get(tab.id, function(info){
				if(info.url.indexOf('oauth_verifier=') != -1){
					var u = url.parse(info.url, true).query;
					chrome.tabs.remove(tab.id);
					console.log(u);
					token = u.oauth_token;
					Token[u.oauth_token](u.oauth_verifier, function(error, requester){
						console.log(error, requester)
						console.log('oauth STEP 3')
					})
				}else{
					setTimeout(poll, 100)
				}
				
			})
		};
		poll();
	})
	console.log(url)
})


</script>